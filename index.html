<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>agent-v0</title>

  <style>
    body { font-family: Arial; margin: 2rem; color:#111;}
    .status { font-weight:700;}
    .ok { color:#0a7a0a;}
    .err { color:#b00020;}
    input { padding:0.5rem; width:320px; margin-right:10px;}
    button { padding:0.5rem;}
    pre { margin-top:1rem; background:#fafafa; padding:1rem; border-radius:6px;}
  </style>

  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>

<body>

<h1>agent-v0</h1>
<p>Frontend deployed on Vercel.</p>

<p>
Backend API check:
<span id="apiStatus" class="status">checking‚Ä¶</span>
</p>

<hr/>

<h2>Test your agent</h2>

<input id="question" placeholder="Ask something..." />
<button onclick="askAgent()">Send</button>

<pre id="response"></pre>

<script>

const API_URL = "https://agent-backend-45l0yg6pn-scx7189s-projects.vercel.app/api/agent";

const SECRET = "Laretraitesoon,99"; // ‚ö†Ô∏è remplace ici


// üî• CHECK API
(async () => {

  const el = document.getElementById("apiStatus");

  try {

    const res = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-agent-secret": SECRET
      },
      body: JSON.stringify({
        messages: [{ role:"user", content:"ping"}]
      })
    });

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }

    el.textContent = "connected ‚úÖ";
    el.classList.add("ok");

  } catch (err) {

    el.textContent = `not reachable (${err.message})`;
    el.classList.add("err");

    console.error("API ERROR:", err);
  }

})();


// üî• CALL AGENT
async function askAgent() {

  const responseBox = document.getElementById("response");
  const question = document.getElementById("question").value.trim();

  if (!question) {
    responseBox.textContent = "‚ö†Ô∏è Please enter a question.";
    return;
  }

  responseBox.textContent = "Thinking...";

  try {

    const res = await fetch(API_URL, {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "x-agent-secret": SECRET
      },
      body: JSON.stringify({
        messages:[
          { role:"user", content:question }
        ]
      })
    });

    const data = await res.json();

    responseBox.textContent =
      data.response || JSON.stringify(data, null, 2);

  } catch (err) {

    responseBox.textContent = "‚ùå Error calling agent.";
    console.error(err);

  }
}

</script>

</body>
</html>
